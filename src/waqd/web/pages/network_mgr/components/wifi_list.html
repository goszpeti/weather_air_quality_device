<div x-data="wifiMgr()" x-init="initWifiStates()">
  <template x-for="network in wifiNetworks">
    <div :id="`${network.ssid}_main`" class="stat rounded-box shadow-md"
      :class="network.inUse ? 'bg-base-300' : 'bg-base-200'">
      <div class="stat-title"></div>
      <div class="stat-value">
        <div class="flex flex-col p-2">
          <div class="flex flex-row items-center">
            <svg viewBox="0 0 24 24" class="h-8">
              <use :href="getWifiIcon(network)" fill="white" />
            </svg>
            <div class="text-s text-wrap tracking-wide p-4" x-text="network.ssid"></div>
            <button x-show="!network.showDialog"
              x-on:click="network.inUse ? disconnect(network.ssid) : tryConnect(network.ssid)"
              :class="network.inUse ? 'btn btn-lg btn-info ml-auto p-4' : 'btn btn-lg btn-secondary ml-auto p-4'">
              <span x-text="network.inUse ? 'Disconnect' : 'Connect'"></span>
              <span x-show="network.disconnecting || network.connecting"
                class="loading loading-xs loading-spinner ml-4 p-2"></span>
            </button>
          </div>
          <div x-show="network.showDialog" class="mt-2" x-effect="
            if (network.showDialog) {
              setTimeout(() => {
                const input = $el.querySelector('input.js-kioskboard-input');
                if (input && window.KioskBoard) {
                  window.KioskBoard.run(input);
                }
              }, 0);
            }
          ">
            <div class="flex flex-row items-center gap-4 p-2">
              <input x-model="network.password" type="password" placeholder="Password"
                class="input input-lg input-bordered w-full max-w-xs -pr-8 js-kioskboard-input"
                data-kioskboard-specialcharacters="true" data-kioskboard-type="keyboard"
                x-ref="pwInput"
                :id="`${network.ssid}_pw_input`" />
              <button type="button" class="btn btn-square btn-lg btn-secondary"
                :id="`${network.ssid}_pw_toggle`"
                x-ref="pwToggle"
                x-on:click="togglePasswordVisibility($refs.pwInput, $refs.pwToggle)">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24">
                  <use href="/static/general_icons/visibility.svg#main" fill="white" />
                </svg>
              </button>
            </div>
            <div class="flex flex-row items-center gap-4 p-2">
              <button type="button" class="btn btn-lg btn-secondary mr-4"
                x-on:click="network.showDialog = false">
                Cancel
              </button>
              <button type="button" class="btn btn-lg btn-secondary"
                x-on:click="connect(network.ssid)">
                Next
                <span x-show="network.connecting"
                  class="loading loading-xs loading-spinner ml-4 p-2"></span>
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="stat-desc flex flex-row items-center gap-4 p-2">
        <span x-text="`Signal: ${network.signal}%`"></span>
        <span :id="`${network.ssid}_security`" x-text="`Security: ${network.security}`"></span>
      </div>
    </div>
  </template>
</div>

<script id="wifi-data" type="application/json">
{
  {% for network in wifi_networks.values() %}
  "{{ network.ssid }}": {
    "ssid": "{{ network.ssid }}",
    "signal": {{ network.signal }},
    "security": "{{ network.security }}",
    "inUse": {{ 'true' if network.in_use else 'false' }},
    "showDialog": false,
    "connecting": false,
    "disconnecting": false,
    "password": ""
  }{% if not loop.last %}, {% endif %}
  {% endfor %}
}
</script>